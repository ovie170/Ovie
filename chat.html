<script>
let currentAI = null;

function startChat(name) {
  currentAI = name;
  const messages = document.getElementById('messages');
  messages.innerHTML = `
    <div class='bubble from-ai'>Hi, I’m <strong>${name}</strong>. Let’s chat!</div>
  `;
}

function sendMessage() {
  const input = document.getElementById('messageInput');
  const text = input.value.trim();
  if (!text || !currentAI) return;

  const messages = document.getElementById('messages');

  const userBubble = document.createElement('div');
  userBubble.className = 'bubble from-user';
  userBubble.textContent = text;
  messages.appendChild(userBubble);

  const aiBubble = document.createElement('div');
  aiBubble.className = 'bubble from-ai';
  aiBubble.textContent = `Thinking...`;
  messages.appendChild(aiBubble);

  input.value = '';
  messages.scrollTop = messages.scrollHeight;

  fetch("https://us-central1-ovie-fc407.cloudfunctions.net/chatWithAI", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: text, ai: currentAI })
  })
    .then(res => res.json())
    .then(data => {
      aiBubble.textContent = `${currentAI}: ${data.reply}`;
    })
    .catch(() => {
      aiBubble.textContent = `${currentAI}: Something went wrong 😢`;
    });
}
</script>
